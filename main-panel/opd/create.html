<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application | New OPD Entry</title>
    <link rel="icon" href="../../images/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../../styles/common.css">
</head>

<body class="h-dvh flex flex-col">
    <!--Nav-->
    <div class="nav bg-basic w-full py-6 flex justify-between items-center max-lg:justify-center max-lg:flex-col">
        <span class="flex items-center gap-3 ml-20 max-lg:ml-0 max-sm:scale-75">
            <button onclick="history.go ( -1);"
                class="rounded-full w-[50px] text-basic aspect-square bg-white flex justify-center items-center hover:scale-90 transition-all">
                <i class="bi bi-chevron-left scale-[1.5]"></i>
            </button>
            <button onclick="window.location.href = '../';"
                class="p-2 text-basic rounded-lg bg-white flex gap-3 justify-center items-center hover:scale-90 transition-all">
                <i class="bi bi-house scale-[1.2]"></i>
                Go to OPD Panel
            </button>
        </span>
        <span class="flex items-center gap-3 mr-20 max-lg:mr-0 max-sm:scale-75">
            <h3 class="text-2xl max-md:text-sm text-white">New OPD Entry</h3>
            <button onclick="window.location.href = '../../../';"
                class="rounded-full w-[50px] text-basic aspect-square bg-white flex justify-center items-center hover:scale-90 transition-all">
                <i class="bi bi-box-arrow-left scale-[1.5]"></i>
            </button>
        </span>
    </div>
    <div class="flex-grow flex flex-col overflow-y-auto">
        <!--breadcrumbs-->
        <div class="px-12 max-sm:px-6 pt-5">
            <nav class="flex" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-2 rtl:space-x-reverse">
                    <li class="inline-flex items-center">
                        <p class="inline-flex items-center text-sm font-medium text-gray-700">
                            Main Panel
                        </p>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1" aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2" d="m1 9 4-4-4-4" />
                            </svg>
                            <p class="ms-1 text-sm font-medium text-gray-700 md:ms-2">OPD Management</p>
                        </div>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1" aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2" d="m1 9 4-4-4-4" />
                            </svg>
                            <p class="ms-1 text-sm font-medium text-gray-700 md:ms-2">New OPD Entry</p>
                        </div>
                    </li>
                </ol>
            </nav>
        </div>
        <!--form panel-->
        <div class="p-6">
            <div class="flex flex-col border-2 h-full rounded-lg p-6 bg-white shadow-sm">
                <div class="grid gap-6 mb-6 md:grid-cols-2">
                    <div>
                        <label for="pet_id" class="block mb-2 text-sm font-medium text-black">Pet ID / Code *</label>
                        <select id="pet_id"
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                            required>
                            <option value="">Select Pet</option>
                            <!-- Options will be populated from localStorage -->
                        </select>
                    </div>
                    <div>
                        <label for="visit_date" class="block mb-2 text-sm font-medium text-black">Visit Date</label>
                        <input type="date" id="visit_date"
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                            required />
                    </div>
                </div>
                <div class="grid gap-6 mb-6 md:grid-cols-3">
                    <div>
                        <label for="temperature" class="block mb-2 text-sm font-medium text-black">Temperature
                            (°C)</label>
                        <input type="number" id="temperature" step="0.1"
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                            placeholder="38.5" />
                    </div>
                    <div>
                        <label for="weight" class="block mb-2 text-sm font-medium text-black">Weight (kg)</label>
                        <input type="number" id="weight" step="0.1"
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                            placeholder="10.5" />
                    </div>
                    <div>
                        <label for="bp" class="block mb-2 text-sm font-medium text-black">Blood Pressure</label>
                        <input type="text" id="bp"
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                            placeholder="120/80" />
                    </div>
                </div>
                <div class="mb-6">
                    <label for="symptoms" class="block mb-2 text-sm font-medium text-black">Symptoms</label>
                    <textarea id="symptoms"
                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                        placeholder="Describe symptoms..." rows="3"></textarea>
                </div>
                <div class="mb-6">
                    <label for="diagnosis" class="block mb-2 text-sm font-medium text-black">Diagnosis</label>
                    <textarea id="diagnosis"
                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                        placeholder="Enter diagnosis..." rows="3"></textarea>
                </div>
                <div class="mb-6">
                    <label for="treatment" class="block mb-2 text-sm font-medium text-black">Treatment /
                        Medication</label>
                    <textarea id="treatment"
                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                        placeholder="Enter treatment plan..." rows="3"></textarea>
                </div>
                <div class="flex justify-center items-center w-full gap-4 p-4">
                    <button type="button" onclick="saveOPD()"
                        class="py-3 px-6 bg-basic text-white rounded-lg hover:scale-95 transition-all">Save
                        Entry</button>
                    <button type="button" onclick="resetForm()"
                        class="py-3 px-6 bg-black text-white rounded-lg hover:scale-95 transition-all">Reset</button>
                </div>
            </div>
        </div>
        <div class="flex-grow"></div>
        <footer
            class="h-[80px] bg-basic max-md:text-sm max-sm:text-xs max-md:flex-col text-center w-full flex items-center text-white justify-center gap-3">
            <p>2025 © All Rights Reserved | Application | Powered by Silicon Radon Networks (Pvt) Ltd</p>
        </footer>
    </div>

    <script src="../../scripts/common.js"></script>
    <script>
        // Set default date to today
        document.getElementById('visit_date').valueAsDate = new Date();

        // Load pets for the dropdown
        const pets = JSON.parse(localStorage.getItem('pets')) || [];
        const petSelect = document.getElementById('pet_id');
        pets.forEach(pet => {
            const option = document.createElement('option');
            option.value = pet.code;
            option.textContent = `${pet.name} (${pet.code})`;
            petSelect.appendChild(option);
        });

        function saveOPD() {
            const petId = document.getElementById('pet_id').value;
            const visitDate = document.getElementById('visit_date').value;
            const symptoms = document.getElementById('symptoms').value.trim();
            const diagnosis = document.getElementById('diagnosis').value.trim();
            const treatment = document.getElementById('treatment').value.trim();
            const temperature = document.getElementById('temperature').value;
            const weight = document.getElementById('weight').value;

            if (!petId || !visitDate) {
                alert('Please select a pet and visit date');
                return;
            }

            const opdEntries = JSON.parse(localStorage.getItem('opd_entries')) || [];
            const entryCode = 'OPD' + String(opdEntries.length + 1).padStart(5, '0');

            const entry = {
                code: entryCode,
                petId: petId,
                visitDate: visitDate,
                symptoms: symptoms,
                diagnosis: diagnosis,
                treatment: treatment,
                temperature: temperature,
                weight: weight,
                createdAt: new Date().toISOString()
            };

            opdEntries.push(entry);
            localStorage.setItem('opd_entries', JSON.stringify(opdEntries));
            alert('OPD record saved successfully with code: ' + entryCode);
            window.location.href = 'list.html';
        }

        function resetForm() {
            document.getElementById('pet_id').value = '';
            document.getElementById('visit_date').valueAsDate = new Date();
            document.getElementById('symptoms').value = '';
            document.getElementById('diagnosis').value = '';
            document.getElementById('treatment').value = '';
            document.getElementById('temperature').value = '';
            document.getElementById('weight').value = '';
            document.getElementById('bp').value = '';
        }
    </script>
</body>

</html>