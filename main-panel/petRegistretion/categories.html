<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application | Manage Categories</title>
    <link rel="icon" href="../../images/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../styles/common.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>

<body class="min-h-screen flex flex-col bg-gray-50">
    <!--Nav-->
    <div class="nav bg-basic w-full py-4 flex justify-between items-center px-8 shadow-md">
        <!-- Left: Navigation -->
        <div class="flex items-center gap-4">
            <button onclick="history.back()"
                class="w-10 h-10 bg-white text-basic rounded-full flex items-center justify-center hover:scale-95 transition-transform shadow-sm">
                <i class="bi bi-chevron-left text-lg"></i>
            </button>
            <button onclick="window.location.href = '../';"
                class="px-4 py-2 bg-white text-basic rounded-lg flex items-center gap-2 hover:scale-95 transition-transform shadow-sm font-semibold text-sm">
                <i class="bi bi-building"></i>
                <span class="hidden sm:inline">Go to Main Panel</span>
            </button>
        </div>

        <!-- Center: Logo -->
        <div class="flex-1 flex justify-center">
            <img src="../../images/logo.png" alt="Logo" class="h-12 w-auto drop-shadow-md">
        </div>

        <!-- Right: User Info -->
        <div class="flex items-center gap-4">
            <div class="text-right text-white hidden sm:block">
                <h2 class="text-lg font-bold leading-tight">Good Evening!</h2>
                <p class="text-xs text-blue-200">Welcome Admin</p>
            </div>
            <button onclick="window.location.href = '../../';"
                class="w-10 h-10 bg-white text-basic rounded-full flex items-center justify-center hover:scale-95 transition-transform shadow-sm">
                <i class="bi bi-box-arrow-right text-lg"></i>
            </button>
        </div>
    </div>

    <!-- Content -->
    <div class="flex-grow flex flex-col items-center w-full relative">

        <!-- Breadcrumbs -->
        <div class="page-padding w-full">
            <nav class="flex" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-2 rtl:space-x-reverse">
                    <li class="inline-flex items-center">
                        <a href="../../index.html"
                            class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600">
                            <svg class="w-3 h-3 me-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                                fill="currentColor" viewBox="0 0 20 20">
                                <path
                                    d="m19.707 9.293-2-2-7-7a1 1 0 0 0-1.414 0l-7 7-2 2a1 1 0 0 0 1.414 1.414L2 10.414V18a2 2 0 0 0 2 2h3a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h3a2 2 0 0 0 2-2v-7.586l.293.293a1 1 0 0 0 1.414-1.414Z" />
                            </svg>
                            Main Panel
                        </a>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1" aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2" d="m1 9 4-4-4-4" />
                            </svg>
                            <a href="index.html"
                                class="ms-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ms-2">Pet
                                Management</a>
                        </div>
                    </li>
                    <li aria-current="page">
                        <div class="flex items-center">
                            <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1" aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2" d="m1 9 4-4-4-4" />
                            </svg>
                            <span class="ms-1 text-sm font-medium text-gray-500 md:ms-2">Manage Categories</span>
                        </div>
                    </li>
                </ol>
            </nav>
        </div>

        <!-- Main Panel Content -->
        <div class="w-full px-8 pb-6 flex flex-col items-center">
            <div class="w-full flex-grow flex flex-col bg-white rounded-lg shadow border">
                <div class="p-4 border-b bg-gray-50 flex justify-between items-center">
                    <div class="relative w-full max-w-sm">
                        <i class="bi bi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="searchCategory" onkeyup="renderCategories()"
                            placeholder="Search categories..."
                            class="w-full pl-10 pr-4 py-2 border rounded-lg text-sm bg-white focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <button onclick="openAddModal()"
                        class="bg-basic text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-opacity-90 flex items-center gap-2">
                        <i class="bi bi-plus-lg"></i> New Category
                    </button>
                </div>

                <div class="w-full">
                    <table class="w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                            <tr>
                                <th scope="col" class="px-6 py-3">Category Name</th>
                                <th scope="col" class="px-6 py-3">Code / Prefix</th>
                                <th scope="col" class="px-6 py-3">Breeds</th>
                                <th scope="col" class="px-6 py-3 text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="categoriesTable">
                            <!-- Rows injected here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- Footer -->
        <footer class="bg-basic py-4 text-center text-white text-xs z-20 shrink-0 w-full mt-auto">
            <p>2026 Â© All Rights Reserved | Royal Pets Animal Hospital | Designed and Developed by Silicon Radon
                Networks (Pvt) Ltd</p>
        </footer>
    </div>

    <!-- Add/Edit Modal -->
    <div id="categoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center">
        <div class="bg-white rounded-lg w-full max-w-md p-6">
            <h3 class="text-lg font-bold mb-4" id="modalTitle">Add New Category</h3>
            <form id="categoryForm" onsubmit="saveCategory(event)">
                <input type="hidden" id="catId">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">Category Name</label>
                    <input type="text" id="catName" required class="w-full border rounded p-2" placeholder="e.g. Dog">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">Code / Prefix (Optional)</label>
                    <input type="text" id="catCode" class="w-full border rounded p-2" placeholder="e.g. DG">
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button" onclick="closeModal()"
                        class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">Cancel</button>
                    <button type="submit"
                        class="px-4 py-2 bg-basic text-white rounded hover:bg-opacity-90">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Manage Breeds Modal -->
    <div id="breedsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center">
        <div class="bg-white rounded-lg w-full max-w-lg p-6 h-[80vh] flex flex-col">
            <div class="flex justify-between items-center mb-4 pb-2 border-b">
                <h3 class="text-lg font-bold">Manage Breeds: <span id="breedCatName" class="text-blue-600"></span></h3>
                <button onclick="closeBreedsModal()" class="text-gray-500 hover:text-gray-700"><i
                        class="bi bi-x-lg"></i></button>
            </div>

            <div class="flex gap-2 mb-4">
                <input type="text" id="newBreedName" class="flex-grow border rounded p-2 text-sm"
                    placeholder="Enter breed name...">
                <button onclick="addBreed()"
                    class="bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700">Add</button>
            </div>

            <div class="flex-grow overflow-y-auto bg-gray-50 rounded border p-2">
                <ul id="breedsList" class="space-y-2">
                    <!-- Breeds list injected here -->
                </ul>
            </div>
        </div>
    </div>

    <script src="../../scripts/common.js"></script>
    <script>
        // --- Data ---
        let categories = JSON.parse(localStorage.getItem('pet_categories')) || [
            { id: 1, name: 'Dog', code: 'DG', breeds: ['Golden Retriever', 'German Shepherd', 'Poodle'] },
            { id: 2, name: 'Cat', code: 'CT', breeds: ['Persian', 'Siamese', 'Maine Coon'] },
            { id: 3, name: 'Bird', code: 'BD', breeds: ['Parrot', 'Canary'] },
            { id: 4, name: 'Rabbit', code: 'RB', breeds: [] }
        ];

        let editingId = null;
        let selectedCatId = null;

        // --- Render ---
        function renderCategories() {
            const tbody = document.getElementById('categoriesTable');
            const search = document.getElementById('searchCategory').value.toLowerCase();
            tbody.innerHTML = '';

            const filtered = categories.filter(c => c.name.toLowerCase().includes(search) || (c.code && c.code.toLowerCase().includes(search)));

            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="px-6 py-8 text-center text-gray-400">No categories found.</td></tr>';
                return;
            }

            filtered.forEach(c => {
                const tr = document.createElement('tr');
                const breedCount = c.breeds ? c.breeds.length : 0;

                tr.className = "bg-white border-b hover:bg-gray-50";
                tr.innerHTML = `
                        <td class="px-6 py-4 font-bold text-gray-800">${c.name}</td>
                        <td class="px-6 py-4 font-mono text-gray-600">${c.code || '-'}</td>
                        <td class="px-6 py-4">
                            <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">${breedCount} Breeds</span>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <button onclick="manageBreeds(${c.id})" class="text-purple-600 hover:underline mr-3 font-medium">Manage Breeds</button>
                            <button onclick="editCategory(${c.id})" class="text-blue-600 hover:underline mr-3">Edit</button>
                            <button onclick="deleteCategory(${c.id})" class="text-red-500 hover:underline">Delete</button>
                        </td>
                     `;
                tbody.appendChild(tr);
            });
        }

        // --- Logic ---
        function saveData() {
            localStorage.setItem('pet_categories', JSON.stringify(categories));
            renderCategories();
        }

        function openAddModal() {
            editingId = null;
            document.getElementById('modalTitle').innerText = "Add New Category";
            document.getElementById('categoryForm').reset();
            document.getElementById('categoryModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('categoryModal').classList.add('hidden');
        }

        function saveCategory(e) {
            e.preventDefault();
            const name = document.getElementById('catName').value;
            const code = document.getElementById('catCode').value;

            if (editingId) {
                // Update
                const idx = categories.findIndex(c => c.id === editingId);
                if (idx !== -1) {
                    categories[idx].name = name;
                    categories[idx].code = code;
                }
            } else {
                // Create
                categories.push({
                    id: Date.now(),
                    name,
                    code,
                    breeds: []
                });
            }
            saveData();
            closeModal();
        }

        function editCategory(id) {
            const cat = categories.find(c => c.id === id);
            if (!cat) return;

            editingId = id;
            document.getElementById('modalTitle').innerText = "Edit Category";
            document.getElementById('catName').value = cat.name;
            document.getElementById('catCode').value = cat.code || '';
            document.getElementById('categoryModal').classList.remove('hidden');
        }

        function deleteCategory(id) {
            if (confirm("Delete this category?")) {
                categories = categories.filter(c => c.id !== id);
                saveData();
            }
        }

        // --- Breeds Logic ---
        function manageBreeds(id) {
            const cat = categories.find(c => c.id === id);
            if (!cat) return;

            selectedCatId = id;
            if (!cat.breeds) cat.breeds = [];

            document.getElementById('breedCatName').innerText = cat.name;
            renderBreedsList();
            document.getElementById('breedsModal').classList.remove('hidden');
        }

        function closeBreedsModal() {
            document.getElementById('breedsModal').classList.add('hidden');
            selectedCatId = null;
        }

        function renderBreedsList() {
            const list = document.getElementById('breedsList');
            const cat = categories.find(c => c.id === selectedCatId);
            list.innerHTML = '';

            if (!cat || !cat.breeds || cat.breeds.length === 0) {
                list.innerHTML = '<li class="text-center text-gray-400 py-4">No breeds added yet.</li>';
                return;
            }

            cat.breeds.forEach((breed, index) => {
                const li = document.createElement('li');
                li.className = "flex justify-between items-center bg-white p-2 border rounded shadow-sm";
                li.innerHTML = `
                    <span class="text-gray-800 font-medium">${breed}</span>
                    <button onclick="deleteBreed(${index})" class="text-red-500 hover:text-red-700"><i class="bi bi-trash"></i></button>
                `;
                list.appendChild(li);
            });
        }

        function addBreed() {
            const input = document.getElementById('newBreedName');
            const name = input.value.trim();
            if (!name) return;

            const cat = categories.find(c => c.id === selectedCatId);
            if (cat) {
                if (!cat.breeds) cat.breeds = [];
                cat.breeds.push(name);
                saveData();
                renderBreedsList();
                renderCategories(); // update count in table
                input.value = '';
                input.focus();
            }
        }

        function deleteBreed(index) {
            const cat = categories.find(c => c.id === selectedCatId);
            if (cat && confirm("Remove this breed?")) {
                cat.breeds.splice(index, 1);
                saveData();
                renderBreedsList();
                renderCategories();
            }
        }

        // Init
        renderCategories();

    </script>
</body>

</html>