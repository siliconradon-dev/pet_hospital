<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application | Items</title>
    <link rel="icon" href="../../images/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link rel="stylesheet" href="../../styles/common.css">
</head>

<body class="h-dvh flex flex-col">
    <!--Nav-->
    <div class="nav bg-basic w-full py-6 flex justify-between items-center max-lg:justify-center max-lg:flex-col">
        <span class="flex items-center gap-3 ml-20 max-lg:ml-0 max-sm:scale-75">
            <button onclick="history.go ( -1);"
                class="rounded-full w-[50px] text-basic aspect-square bg-white flex justify-center items-center hover:scale-90 transition-all">
                <i class="bi bi-chevron-left scale-[1.5]"></i>
            </button>
            <button onclick="window.location.href = '../../../main-panel/';"
                class="p-2 text-basic rounded-lg bg-white flex gap-3 justify-center items-center hover:scale-90 transition-all">
                <i class="bi bi-house scale-[1.2]"></i>
                Go to Main Panel
            </button>
        </span>
        <span class="flex items-center gap-3 mr-20 max-lg:mr-0 max-sm:scale-75">
            <!--Logged User-->
            <h3 class="text-2xl max-md:text-sm text-white">Register Pet</h3>
            <!--log out btn-->
            <button onclick="window.location.href = '../../../';"
                class="rounded-full w-[50px] text-basic aspect-square bg-white flex justify-center items-center hover:scale-90 transition-all">
                <i class="bi bi-box-arrow-left scale-[1.5]"></i>
            </button>
        </span>
    </div>
    <div class="flex-grow flex flex-col">
        <!--breadcrumbs-->
        <div class="px-12 max-sm:px-6 pt-5">
            <nav class="flex flex-wrap md:justify-between" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-2 rtl:space-x-reverse">
                    <li class="inline-flex items-center">
                        <p class="inline-flex items-center text-sm font-medium text-gray-700">
                            <svg class="w-3 h-3 me-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                                fill="currentColor" viewBox="0 0 20 20">
                                <path
                                    d="m19.707 9.293-2-2-7-7a1 1 0 0 0-1.414 0l-7 7-2 2a1 1 0 0 0 1.414 1.414L2 10.414V18a2 2 0 0 0 2 2h3a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h3a2 2 0 0 0 2-2v-7.586l.293.293a1 1 0 0 0 1.414-1.414Z" />
                            </svg>
                            Main Panel
                        </p>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1" aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2" d="m1 9 4-4-4-4" />
                            </svg>
                            <p class="ms-1 text-sm font-medium text-gray-700 md:ms-2">Pet Management</p>
                        </div>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1" aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2" d="m1 9 4-4-4-4" />
                            </svg>
                            <p class="ms-1 text-sm font-medium text-gray-700 md:ms-2">Pet List</p>
                        </div>
                    </li>
                </ol>

                <!-- Right side buttons -->
                <span class="w-fit max-md:w-full max-md:justify-center flex gap-3 max-sm:gap-1 max-[350px]:scale-75">
                    <button
                        class="hidden px-2 py-1.5 text-white bg-[#0b2b64] rounded-lg max-sm:px-2 max-sm:py-1">Copy</button>
                    <button class="hidden px-2 py-3 text-white bg-[#0b2b64] rounded-lg max-sm:px-2 max-sm:py-1"
                        onclick="exportTableToCSV('item.csv')">CSV</button>
                    <button
                        class="hidden px-2 py-1.5 text-white bg-[#0b2b64] rounded-lg max-sm:px-2 max-sm:py-1">Excel</button>
                    <button
                        class="hidden px-2 py-1.5 text-white bg-[#0b2b64] rounded-lg max-sm:px-2 max-sm:py-1">PDF</button>
                    <button data-popover-target="popover-click" data-popover-trigger="click"
                        data-popover-placement="bottom" type="button"
                        class="px-2 py-3 text-white bg-[#0b2b64] rounded-lg max-sm:px-2 max-sm:py-1">
                        Column Visibility
                    </button>
                    <div data-popover id="popover-click" role="tooltip"
                        class="absolute z-10 invisible inline-block text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0 w-fit">
                        <ul
                            class="flex flex-col w-full text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-lg">
                            <!-- First Column -->
                            <li>
                                <input id="filter_hash" type="checkbox" checked class="hidden peer">
                                <label for="filter_hash"
                                    class="flex w-full px-3 py-1.5 border-b border-gray-200 rounded-t-lg select-none peer-checked:bg-blue-300"
                                    onclick="filterColumn('#');">
                                    #
                                </label>
                            </li>
                            <!-- Second Column -->
                            <li>
                                <input id="filter_name" type="checkbox" checked class="hidden peer">
                                <label for="filter_name"
                                    class="flex w-full px-3 py-1.5 border-b border-gray-200 select-none peer-checked:bg-blue-300"
                                    onclick="filterColumn('Item Name');">
                                    ItemName
                                </label>
                            </li>
                            <!-- Third Column -->
                            <li>
                                <input id="filter_qty" type="checkbox" checked class="hidden peer">
                                <label for="filter_qty"
                                    class="flex w-full px-3 py-1.5 border-b border-gray-200 select-none peer-checked:bg-blue-300"
                                    onclick="filterColumn('Qty');">
                                    Qty
                                </label>
                            </li>
                            <!-- Fourth Column -->
                            <li>
                                <input id="filter_status" type="checkbox" checked class="hidden peer">
                                <label for="filter_status"
                                    class="flex w-full px-3 py-1.5 border-b border-gray-200 select-none peer-checked:bg-blue-300"
                                    onclick="filterColumn('Status');">
                                    Status
                                </label>
                            </li>
                            <!-- Fifth Column -->
                            <li>
                                <input id="filter_manage" type="checkbox" checked class="hidden peer">
                                <label for="filter_manage"
                                    class="flex w-full px-3 py-1.5 rounded-b-lg select-none peer-checked:bg-blue-300"
                                    onclick="filterColumn('Manage');">
                                    Manage
                                </label>
                            </li>
                        </ul>
                        <div data-popper-arrow></div>
                    </div>
                </span>
            </nav>
        </div>
        <!--main panel-->
        <div class="p-6">
            <div class="flex flex-col border-2 h-full rounded-lg p-6">
                <!--filter section-->
                <div class="mb-4">
                    <button onclick="window.location.href='register.html'"
                        class="px-4 py-2 bg-[#0b2b64] text-white rounded-lg hover:bg-[#65adff]">
                        + Add New Pet
                    </button>
                </div>

                <!--table with pet info-->
                <div class="relative overflow-x-auto">
                    <table id="petsTable" class="w-full text-sm text-left text-gray-500 rtl:text-right">
                        <thead class="text-xs text-white uppercase bg-[#0b2b64]">
                            <tr>
                                <th scope="col" class="px-4 py-2 rounded-tl-lg">#</th>
                                <th scope="col" class="px-4 py-2">Image</th>
                                <th scope="col" class="px-4 py-2">Pet Code</th>
                                <th scope="col" class="px-4 py-2">Pet Name</th>
                                <th scope="col" class="px-4 py-2">Breed</th>
                                <th scope="col" class="px-4 py-2">Age</th>
                                <th scope="col" class="px-4 py-2 rounded-tr-lg">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="petsTableBody">
                            <!-- Pet data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- QR/Barcode Modal -->
        <div id="codeModal"
            class="fixed inset-0 z-50 flex items-center justify-center hidden bg-gray-500 bg-opacity-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-md">
                <h2 id="modalTitle" class="text-xl font-semibold mb-4">Generated Code</h2>
                <div id="codeContainer" class="flex items-center justify-center mb-4 min-h-[200px]">
                    <!-- QR code or barcode will appear here -->
                </div>
                <div class="flex justify-end gap-3">
                    <button id="downloadBtn"
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Download</button>
                    <button id="closeModalBtn"
                        class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">Close</button>
                </div>
            </div>
        </div>

        <!-- Pet Profile Modal -->
        <div id="profileModal"
            class="fixed inset-0 z-50 flex items-center justify-center hidden bg-gray-500 bg-opacity-50">
            <div class="bg-white rounded-lg p-8 w-full max-w-2xl">
                <div class="text-center">
                    <img id="profileImage" src="" alt="Pet Image"
                        class="w-48 h-48 mx-auto rounded-full object-cover border-4 border-[#0b2b64] mb-4">
                    <h2 id="profileName" class="text-3xl font-bold text-gray-800 mb-2"></h2>
                    <p id="profileCode" class="text-lg text-gray-600 mb-4"></p>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">Breed</p>
                            <p id="profileBreed" class="text-lg font-semibold text-gray-800"></p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">Age</p>
                            <p id="profileAge" class="text-lg font-semibold text-gray-800"></p>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <p class="text-sm text-gray-600 mb-2">Description</p>
                        <p id="profileDescription" class="text-gray-800"></p>
                    </div>
                    <button onclick="closeProfileModal()"
                        class="px-6 py-2 bg-[#0b2b64] text-white rounded-lg hover:bg-[#65adff]">Close</button>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div class="flex-grow"></div>
    <footer
        class="h-[80px] bg-basic max-md:text-sm max-sm:text-xs max-md:flex-col text-center w-full flex items-center text-white justify-center gap-3">
        <p>2025 Â© All Rights Reserved | Application | Powered by Silicon Radon Networks (Pvt) Ltd</p>
    </footer>
    </div>

</body>
<script src="../../scripts/common.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.4.4/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
<script>
    // Load pets from localStorage and add sample data if empty
    let pets = JSON.parse(localStorage.getItem('pets')) || [];

    // Add 2 sample pets if none exist
    if (pets.length === 0) {
        pets = [
            {
                code: 'RP00001',
                name: 'Max',
                age: '3',
                breed: 'Golden Retriever',
                description: 'Friendly and energetic dog, loves to play fetch and swim. Very good with children and other pets.',
                image: 'https://images.unsplash.com/photo-1633722715463-d30f4f325e24?w=400',
                registeredDate: new Date().toISOString(),
                allergies: ['Fish', 'Dust', 'Certain Fragrances']
            },
            {
                code: 'RP00002',
                name: 'Whiskers',
                age: '2',
                breed: 'Persian Cat',
                description: 'Calm and affectionate cat with beautiful long fur. Enjoys quiet environments and loves to be pampered.',
                image: 'https://images.unsplash.com/photo-1518791841217-8f162f1e1131?w=400',
                registeredDate: new Date().toISOString(),
                allergies: ['Fish', 'Dust', 'Certain Fragrances']
            }
        ];
        localStorage.setItem('pets', JSON.stringify(pets));
    }

    // Load pets into table
    function loadPets() {
        const tbody = document.getElementById('petsTableBody');
        tbody.innerHTML = '';

        pets.forEach((pet, index) => {
            const row = document.createElement('tr');
            row.className = 'text-black bg-white border-2';
            row.innerHTML = `
                <td class="px-4 py-2 font-medium">${index + 1}</td>
                <td class="px-4 py-2">
                    <img src="${pet.image}" alt="${pet.name}" class="w-12 h-12 rounded-full object-cover">
                </td>
                <td class="px-4 py-2">${pet.code}</td>
                <td class="px-4 py-2">${pet.name}</td>
                <td class="px-4 py-2">${pet.breed}</td>
                <td class="px-4 py-2">${pet.age} years</td>
                <td class="px-4 py-2">
                    <button onclick="generateQRCode('${pet.code}')" class="px-3 py-1.5 mr-2 mb-1 text-white bg-[#0b2b64] rounded-lg hover:bg-[#65adff]">QR Code</button>
                    <button onclick="generateBarcode('${pet.code}')" class="px-3 py-1.5 mr-2 mb-1 text-white bg-[#0b2b64] rounded-lg hover:bg-[#65adff]">Barcode</button>
                    <button onclick="viewProfile('${pet.code}')" class="px-3 py-1.5 mb-1 text-white bg-blue-600 rounded-lg hover:bg-blue-700">View Profile</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    // Generate QR Code
    function generateQRCode(petCode) {
        const pet = pets.find(p => p.code === petCode);
        if (!pet) return;

        const profileURL = window.location.origin + window.location.pathname.replace('list.html', 'profile.html?code=') + petCode;
        const codeContainer = document.getElementById('codeContainer');
        codeContainer.innerHTML = '';

        const qrCodeImg = document.createElement('img');
        codeContainer.appendChild(qrCodeImg);

        QRCode.toDataURL(profileURL, { width: 200, height: 200 }, function (err, url) {
            if (err) {
                console.error('Error generating QR code:', err);
                return;
            }
            qrCodeImg.src = url;

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 250;
            canvas.height = 250;

            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const img = new Image();
            img.src = url;

            img.onload = function () {
                ctx.drawImage(img, 25, 25, 200, 200);
                ctx.textAlign = 'center';
                ctx.font = '16px Arial';
                ctx.fillStyle = 'black';
                ctx.fillText(`Pet Code: ${petCode}`, canvas.width / 2, 230);

                document.getElementById('modalTitle').innerText = `QR Code for ${pet.name}`;
                document.getElementById('codeModal').classList.remove('hidden');

                document.getElementById('downloadBtn').onclick = function () {
                    const link = document.createElement('a');
                    link.href = canvas.toDataURL('image/png');
                    link.download = `${petCode}_QR_Code.png`;
                    link.click();
                };
            };
        });
    }

    // Generate Barcode
    function generateBarcode(petCode) {
        const pet = pets.find(p => p.code === petCode);
        if (!pet) return;

        const codeContainer = document.getElementById('codeContainer');
        codeContainer.innerHTML = '';

        const barcodeImg = document.createElement('img');
        codeContainer.appendChild(barcodeImg);

        JsBarcode(barcodeImg, petCode, {
            format: "CODE128",
            width: 2,
            height: 100,
            displayValue: true
        });

        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 250;
        canvas.height = 150;

        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        setTimeout(() => {
            ctx.drawImage(barcodeImg, 25, 25, 200, 100);

            document.getElementById('modalTitle').innerText = `Barcode for ${pet.name}`;
            document.getElementById('codeModal').classList.remove('hidden');

            document.getElementById('downloadBtn').onclick = function () {
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/png');
                link.download = `${petCode}_Barcode.png`;
                link.click();
            };
        }, 100);
    }

    // View pet profile
    function viewProfile(petCode) {
        const pet = pets.find(p => p.code === petCode);
        if (!pet) return;

        // document.getElementById('profileImage').src = pet.image;
        // document.getElementById('profileName').textContent = pet.name;
        // document.getElementById('profileCode').textContent = `Pet Code: ${pet.code}`;
        // document.getElementById('profileBreed').textContent = pet.breed;
        // document.getElementById('profileAge').textContent = pet.age + ' years';
        // document.getElementById('profileDescription').textContent = pet.description || 'No description available';
        // document.getElementById('profileModal').classList.remove('hidden');

        // redirect to profile page
        window.location.href = `profile.html?code=${petCode}`;
    }

    // Close modals
    function closeProfileModal() {
        document.getElementById('profileModal').classList.add('hidden');
    }

    document.getElementById('closeModalBtn').addEventListener('click', function () {
        document.getElementById('codeModal').classList.add('hidden');
    });

    // Load pets on page load
    loadPets();
</script>

</html>